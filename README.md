# Parrallel-Distributed-2D-Torus-Random-Walk
 
The key idea in this program is to implement a parallel version of a Markov chain simulation of a “random walk on a 2-D torus” https://en.wikipedia.org/wiki/Random_walk.

## Table of contents
* [General Information](#general-information)
* [File Description](#file-description)
* [Surface Plot](#surface-plot)
* [Code Examples](#code-examples)
* [Contact](#contact)

## General Information
In this program, a system with one particle will perform random walk on a 2D Cartesian torus. In each iteration, the fraction in each cell can make a hop to its nearest neighbors based on given probabilities. This program will give the probability distribution of the whole system after convergence. 

In each iteration, each cell will have transition with its neighbors, which means some fraction will move outside current cell while some fraction from nearest neighbor will move to the current cell.  

The key part of the iteration is the 'OneStep' function in aux.c. Below is the detailed explanation of this function: 

1) For the inner cells (i.e., cells not on the boundary and don’t transit to any other processors), we only need to simply add the transition fraction (e.g., p_e \alpha) to its neighbor cells.

2) For the ghost cells (i.e., cells on the boundary), we need to put the transition fraction in the send buffer (e.g., toEast). The send buffer which stores the array of ghost cells will be send to its neighbor processor.

3) Next, processor will receive the array of transition fraction of ghost cells, and store them in the receive buffer (e.g., Dom->westNB).

4) After all inter processor communication completed, transition fraction in the receiving buffer will be add to the boundary cells.

## File Description
'main.c' is the main driver. 

'makefile' is used for compiling the program efficiently.

The 'aux.c' contains a set of auxilliary functions, which includes 'OneStep' function (used to update probability for each iteration), 'ComputErr' function (used to compute the maximum difference between two processors) and 'get_prob' function (used for generating the probability stencil).

The header file 'inc.h' contains the definition of two data types PointProb and myDomain. PointProb contains an array of probability (stays, west,east, north and south), and myDomain contains information of current domain, such as location, current processor rank, neighbor processor rank, and buffer for boundary cells.

The MATLAB script 'checkOutp.m' is used to generate the sufrace plot of the probability distribution after convergence.

## Surface Plot
This is a surface plot of the probability distribution after convergence generated by checkOutp.m.
![Probability distribution](./surface.png)

## Code Examples
To build the executable program main.ex, run:
```bash
make
```
The program could be run on the radish.cselabs.umn.edu cluster by running:
```bash
mpirun [ -np X ]  <program> qi
```
where X is the number of processors, and qi should divide X. For example:
```bash
mpirun -np 4 main.ex 2
```
In this case, the program will run on a 2x2 processor grid.
 
## Contact
Created by Buyun Liang [liang664@umn.edu] (https://www.linkedin.com/in/buyun-liang/) - feel free to contact me if you have any questions!
